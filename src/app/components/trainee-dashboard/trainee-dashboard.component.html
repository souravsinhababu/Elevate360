<div class="dashboard-container">
  <h2>Welcome, {{ traineename }}</h2>

  <!-- Edit Button to open the form -->
  <button class="edit-button" (click)="openEditTraineeModal()">Edit Details</button>

  <!-- Modal for Editing Trainee Details -->
  <div *ngIf="showEditTraineeModal" class="modal">
    <div class="modal-content">
      <h3>Edit Trainee Details</h3>

      <form [formGroup]="editTraineeForm" (ngSubmit)="onEditTraineeSubmit()" class="edit-form">
        <label for="email">Email:</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          required
          placeholder="Enter new email"
        />
        <div *ngIf="isInvalid('email')" class="error">
          Please enter a valid email.
        </div>

        <label for="password">Password:</label>
        <input
          type="password"
          id="password"
          formControlName="password"
          required
          placeholder="Enter new password"
        />
        <div *ngIf="isInvalid('password')" class="error">
          Password is required and should be at least 6 characters.
        </div>

        <div class="button-container">
          <button type="submit" class="save-button">Save Changes</button>
          <button type="button" (click)="closeEditTraineeModal()" class="close-btn">Close</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Assigned Courses Section -->
  <div *ngIf="trainername && courses">
    <h2 class="assigned-courses-heading">Assigned Courses</h2>

    <div class="trainer-name-container">
      <p class="futuristic-trainer-name">Trainer: <span>{{ trainername }}</span></p>
    </div>

    <div class="timeline">
      <div *ngFor="let course of courses" class="timeline-event">
        <div class="timeline-circle"></div>
        <div class="timeline-content">
          <h4>{{ course.courseName }}</h4>
          <p>Start Date: {{ course.startDate | date: 'shortDate' }}</p>
          <p>End Date: {{ course.endDate | date: 'shortDate' }}</p>
        </div>
      </div>
    </div>
  </div>

  <br>

  <!-- Test Details Section -->
  <div *ngIf="exams.length > 0" class="test-details">
    <h2>Test Details</h2>
    <div class="test-box-container">
      <div *ngFor="let exam of exams" class="test-box" (click)="startFullScreenTest(exam)">
        <div class="test-title">{{ exam.courseName }}</div>
      </div>
    </div>
  </div>

  <!-- Full-Screen Modal for the Test Questions -->
  <div *ngIf="currentExam" class="fullscreen-modal-backdrop">
    <div class="fullscreen-modal-content">
      <h2>{{ currentExam?.courseName }}</h2>
      
      <!-- If the test is already taken, show the score -->
      <div *ngIf="scorePercentage !== undefined">
        <h3>Your Score: {{ scorePercentage }}%</h3>
        <p>Correct Answers: {{ correctAnswers }} / {{ totalQuestions }}</p>
      </div>

      <!-- If the test is not taken yet, show the questions -->
      <div *ngIf="showModal">
        <div class="question">
          <h3>{{ currentExam?.questions[currentQuestionIndex]?.question }}</h3>

          <div *ngFor="let option of currentExam?.questions[currentQuestionIndex]?.options; let i = index">
            <input
              type="radio"
              name="answer"
              [value]="option.option"
              id="option{{i}}"
              [(ngModel)]="selectedAnswers[currentQuestionIndex]">
            <label for="option{{i}}">{{ option.option }}</label><br>
          </div>
        </div>

        <div class="buttons">
          <button (click)="nextQuestion()" [disabled]="currentQuestionIndex === currentExam?.questions.length - 1">Next Question</button>
          <button *ngIf="currentQuestionIndex === currentExam?.questions.length - 1" (click)="submitTest()">Submit Test</button>
        </div>
      </div>

      <button class="fullscreen-close-btn" (click)="closeTest()">Close</button>
    </div>
  </div>

  <!-- Logout button -->
  <button class="logout-button" (click)="logout()">Logout</button>
</div>
