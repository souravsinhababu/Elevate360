<div class="dashboard-container">
  <div class="header">
    <p class="welcome-message">Welcome, Admin!</p>
    <button class="logout-button" (click)="logout()">Logout</button>
  </div>
  <h2>Welcome to the Admin Dashboard</h2>

  <!-- Search and Filter Containers on the Same Line -->
  <div class="search-filter-container">
    <div class="search-container">
      <label for="search">Search: </label>
      <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="search()" id="search" />
    </div>
    <div class="filter-container">
      <label for="role">Filter by Role: </label>
      <select id="role" [(ngModel)]="selectedRole" (change)="filterByRole()">
        <option value="All">All</option>
        <option value="Trainer">Trainer</option>
        <option value="Trainee">Trainee</option>
      </select>
    </div>
  </div>

  <!-- List of Trainers -->
  <div *ngIf="selectedRole === 'Trainer' || selectedRole === 'All'">
    <h3>List of Trainers</h3>
    <div class="action-buttons">
      <button (click)="openAddTrainerModal()">Add Trainer</button>
    </div>
    <div *ngIf="trainers.length > 0">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trainer of trainers">
            <td>{{ trainer.username }}</td>
            <td>{{ trainer.email }}</td>
            <td>
              <button (click)="editTrainer(trainer)" class="edit">Edit</button>
              <button (click)="deleteTrainer(trainer.id)" class="delete">Delete</button>
              <button (click)="openAssignTraineesModal(trainer)">Assign Trainees</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="trainers.length === 0">No trainers found.</div>
  </div>
 
  <!-- List of Trainees -->
  <div *ngIf="selectedRole === 'Trainee' || selectedRole === 'All'">
    <h3>List of Trainees</h3>
    <div class="action-buttons">
      <button (click)="openAddTraineeModal()">Add Trainee</button>
    </div>
    <div *ngIf="trainees.length > 0">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Trainer Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trainee of trainees">
            <td>{{ trainee.username }}</td>
            <td>{{ trainee.email }}</td>
            <td>{{ trainee.trainer_name }}</td>
            <td>
              <button (click)="editTrainee(trainee)" class="edit">Edit</button>
              <button (click)="deleteTrainee(trainee.id)" class="delete">Delete</button>
              <button (click)="assignTrainer(trainee)">Assign Trainer</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="trainees.length === 0">No trainees found.</div>
  </div>
</div>

<!-- Modals for Add/Edit/Assign -->
<!-- Add Trainer Modal -->
<div *ngIf="showAddTrainerModal" class="modal">
  <div class="modal-content">
    <app-add-trainer (addTrainer)="handleAddedTrainer($event)"></app-add-trainer>
    <button (click)="closeAddTrainerModal()" class="close-btn">Close</button>
  </div>
</div>

<!-- Add Trainee Modal -->
<div *ngIf="showAddTraineeModal" class="modal">
  <div class="modal-content">
    <app-add-trainee (addTrainee)="handleAddedTrainee($event)"></app-add-trainee>
    <button (click)="closeAddTraineeModal()" class="close-btn">Close</button>
  </div>
</div>

<!-- Edit Trainer Modal -->
<div *ngIf="selectedTrainer && !isAssigningTrainees" class="modal">
  <div class="modal-content">
    <app-edit-trainer [trainer]="selectedTrainer" (trainerUpdated)="updateTrainerInDashboard($event)"></app-edit-trainer>
    <button (click)="closeEditTrainerModal()" class="close-btn">Close</button>
  </div>
</div>

<!-- Edit Trainee Modal -->
<div *ngIf="selectedTrainee && !isAssigningTrainer" class="modal">
  <div class="modal-content">
    <app-edit-trainee [trainee]="selectedTrainee" (traineeUpdated)="handleUpdatedTrainee($event)"></app-edit-trainee>
    <button (click)="closeEditTraineeModal()" class="close-btn">Close</button>
  </div>
</div>

<!-- Modal for Assigning Trainer -->
<div *ngIf="isAssigningTrainer" class="modal">
  <div class="modal-content">
    <h4>Assign Trainer to {{ selectedTrainee?.username }}</h4>
    <label for="trainer">Select Trainer:</label>
    <select id="trainer" [(ngModel)]="selectedTrainerId">
      <option *ngFor="let trainer of trainers" [value]="trainer.id">{{ trainer.username }}</option>
    </select>
    <button (click)="assignTrainerToTrainee()">Assign</button>
    <button (click)="cancelAssign()">Cancel</button>
  </div>
</div>

<!-- Modal for Assigning Trainees -->
<div *ngIf="isAssigningTrainees" class="modal">
  <div class="modal-content">
    <h4>Assign Trainees to {{ selectedTrainer?.username }}</h4>
    <div *ngFor="let trainee of trainees">
      <label>
        <input type="checkbox" [(ngModel)]="trainee.selected" />
        {{ trainee.username }}
      </label>
    </div>
    <button (click)="assignTraineesToTrainer()">Assign</button>
    <button (click)="cancelAssignTrainees()">Cancel</button>
  </div>
</div>
